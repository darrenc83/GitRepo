(function(n){"use strict";n.widget("ui.selectableScroll",n.ui.selectable,{options:{scrollElement:null,scrollSnapX:5,scrollSnapY:5,scrollAmount:25,scrollIntervalTime:100},_create:function(){this.element.addClass("ui-selectable");this.dragged=!1;this.helperClasses=["no-top","no-right","no-bottom","no-left"];this.scrollElement=this.options.scrollElement||this.element;this.refresh();this._mouseInit();this.helper=n('<div class="ui-selectable-helper"><\/div>')},refresh:function(){var t=this.scrollElement.offset(),i=this.scrollElement.prop("scrollLeft"),r=this.scrollElement.prop("scrollTop");this.selectees=n(this.options.filter,this.scrollElement[0]);this.selectees.addClass("ui-selectee");this.selectees.each(function(){var u=n(this),f=u.offset();n.data(this,"selectable-item",{element:this,$element:u,left:f.left,top:f.top,right:f.left+u.outerWidth(),bottom:f.top+u.outerHeight(),relative:{left:f.left-t.left+i,top:f.top-t.top+r,right:f.left-t.left+i+u.outerWidth(),bottom:f.top-t.top+r+u.outerHeight()},startselected:!1,selected:u.hasClass("ui-selected"),selecting:u.hasClass("ui-selecting"),unselecting:u.hasClass("ui-unselecting")})})},_mouseStart:function(t){var i=this.scrollElement.offset(),r;return t.pageX>this.scrollElement.prop("clientWidth")+i.left||t.pageY>this.scrollElement.prop("clientHeight")+i.top?!1:(r=n.ui.selectable.prototype._mouseStart.call(this,t),this.lastDragEvent=null,this.scrollInfo={elementOffset:this.scrollElement.offset(),scrollWidth:this.scrollElement.prop("scrollWidth"),scrollHeight:this.scrollElement.prop("scrollHeight"),elementWidth:this.scrollElement.prop("clientWidth"),elementHeight:this.scrollElement.prop("clientHeight")},this.scrollInfo.dragStartXPos=t.pageX-this.scrollInfo.elementOffset.left+this.scrollElement.prop("scrollLeft"),this.scrollInfo.dragStartYPos=t.pageY-this.scrollInfo.elementOffset.top+this.scrollElement.prop("scrollTop"),this.scrollIntervalId=null,r)},_updateHelper:function(t){var r,u,o,s,i=[],f,e;for(t.x1-t.scrollLeft<0?(i.push("no-left"),r=this.scrollInfo.elementOffset.left):r=this.scrollInfo.elementOffset.left+t.x1-t.scrollLeft,t.y1-t.scrollTop<0?(i.push("no-top"),u=this.scrollInfo.elementOffset.top):u=this.scrollInfo.elementOffset.top+t.y1-t.scrollTop,t.x2-t.scrollLeft>this.scrollInfo.elementWidth?(i.push("no-right"),o=this.scrollInfo.elementOffset.left+this.scrollInfo.elementWidth):o=this.scrollInfo.elementOffset.left+t.x2-t.scrollLeft,t.y2-t.scrollTop>this.scrollInfo.elementHeight?(i.push("no-bottom"),s=this.scrollInfo.elementOffset.top+this.scrollInfo.elementHeight):s=this.scrollInfo.elementOffset.top+t.y2-t.scrollTop,f=0;f<this.helperClasses.length;f++)e=this.helperClasses[f],n.inArray(e,i)!==-1?this.helper.addClass(e):this.helper.removeClass(e);this.helper.css({left:r,top:u,width:o-r,height:s-u})},_scrollIfNeeded:function(){var n=this.scrollElement.prop("scrollLeft"),t=this.scrollElement.prop("scrollTop"),i=!1;return this.lastDragEvent.pageX-this.scrollInfo.elementOffset.left<this.options.scrollSnapX&&n>0&&(n=n<this.options.scrollAmount?0:n-this.options.scrollAmount,this.scrollElement.prop("scrollLeft",n),i=!0),this.lastDragEvent.pageY-this.scrollInfo.elementOffset.top<this.options.scrollSnapY&&t>0&&(t=t<this.options.scrollAmount?0:t-this.options.scrollAmount,this.scrollElement.prop("scrollTop",t),i=!0),this.lastDragEvent.pageX-this.scrollInfo.elementOffset.left>this.scrollInfo.elementWidth-this.options.scrollSnapX&&this.scrollInfo.scrollWidth>n+this.scrollInfo.elementWidth&&(n=n+this.options.scrollAmount>this.scrollInfo.scrollWidth-this.scrollInfo.elementWidth?this.scrollInfo.scrollWidth-this.scrollInfo.elementWidth:n+this.options.scrollAmount,this.scrollElement.prop("scrollLeft",n),i=!0),this.lastDragEvent.pageY-this.scrollInfo.elementOffset.top>this.scrollInfo.elementHeight-this.options.scrollSnapY&&this.scrollInfo.scrollHeight>n+this.scrollInfo.elementHeight&&(t=t+this.options.scrollAmount>this.scrollInfo.scrollHeight-this.scrollInfo.elementHeight?this.scrollInfo.scrollHeight-this.scrollInfo.elementHeight:t+this.options.scrollAmount,this.scrollElement.prop("scrollTop",t),i=!0),{scrollLeft:n,scrollTop:t,keepScrolling:i}},_calcRelativePosition:function(n){var t=n.x-this.scrollInfo.elementOffset.left+n.scrollLeft,i=n.y-this.scrollInfo.elementOffset.top+n.scrollTop;return{x:t,y:i}},_calcRelativeArea:function(n){var t=n.xPos<this.scrollInfo.dragStartXPos?n.xPos:this.scrollInfo.dragStartXPos,i=n.yPos<this.scrollInfo.dragStartYPos?n.yPos:this.scrollInfo.dragStartYPos,r=n.xPos>this.scrollInfo.dragStartXPos?n.xPos:this.scrollInfo.dragStartXPos,u=n.yPos>this.scrollInfo.dragStartYPos?n.yPos:this.scrollInfo.dragStartYPos;return{x1:t,y1:i,x2:r,y2:u}},_updateSelectees:function(t){var i=this;this.selectees.each(function(){var r=n.data(this,"selectable-item"),u=!1;r&&r.element!==i.element[0]&&(i.options.tolerance==="touch"?u=!(r.relative.left>t.x2||r.relative.right<t.x1||r.relative.top>t.y2||r.relative.bottom<t.y1):i.options.tolerance==="fit"&&(u=r.relative.left>t.x1&&r.relative.right<t.x2&&r.relative.top>t.y1&&r.relative.bottom<t.y2),u?(r.selected&&(r.$element.removeClass("ui-selected"),r.selected=!1),r.unselecting&&(r.$element.removeClass("ui-unselecting"),r.unselecting=!1),r.selecting||(r.$element.addClass("ui-selecting"),r.selecting=!0,i._trigger("selecting",i.lastDragEvent,{selecting:r.element}))):(r.selecting&&((i.lastDragEvent.metaKey||i.lastDragEvent.ctrlKey)&&r.startselected?(r.$element.removeClass("ui-selecting"),r.selecting=!1,r.$element.addClass("ui-selected"),r.selected=!0):(r.$element.removeClass("ui-selecting"),r.selecting=!1,r.startselected&&(r.$element.addClass("ui-unselecting"),r.unselecting=!0),i._trigger("unselecting",i.lastDragEvent,{unselecting:r.element}))),r.selected&&(i.lastDragEvent.metaKey||i.lastDragEvent.ctrlKey||r.startselected||(r.$element.removeClass("ui-selected"),r.selected=!1,r.$element.addClass("ui-unselecting"),r.unselecting=!0,i._trigger("unselecting",i.lastDragEvent,{unselecting:r.element})))))})},_mouseDrag:function(n){if(this.dragged=!0,!this.options.disabled){this.lastDragEvent=n;var t=this._scrollIfNeeded();return this._updateIntervals({keepScrolling:t.keepScrolling}),this._updateUi({doUpdateHelper:!0}),!1}},_updateUi:function(n){var i=this._scrollIfNeeded({pageX:this.lastDragEvent.pageX,pageY:this.lastDragEvent.pageY}),r=this._calcRelativePosition({x:this.lastDragEvent.pageX,y:this.lastDragEvent.pageY,scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}),t=this._calcRelativeArea({xPos:r.x,yPos:r.y});n.doUpdateHelper&&this._updateHelper({scrollLeft:i.scrollLeft,scrollTop:i.scrollTop,x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2});this._updateSelectees({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2})},_updateIntervals:function(n){var t=this;n.keepScrolling&&!this.scrollIntervalId&&(this.scrollIntervalId=setInterval(function(){t._updateUi({doUpdateHelper:!1})},this.options.scrollIntervalTime));!n.keepScrolling&&this.scrollIntervalId&&this._clearIntervals()},_clearIntervals:function(){this.scrollIntervalId&&clearInterval(this.scrollIntervalId);this.scrollIntervalId=null},_mouseStop:function(t){this._clearIntervals();return n.ui.selectable.prototype._mouseStop.call(this,t)}})})(jQuery);