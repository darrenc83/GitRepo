"use strict";var CollectorIndex=new function(){function r(n,i){var r=n?n.toISOString():null,u=i?i.toISOString():null;$.get("/Collector/CollectionsData",{collectorId:t,from:r,to:u},function(n){e(n)})}function e(t){var i,r,f,e;for($(".collection-history-clickable-row").remove(),i=0;i<t.length;i++)t[i].Timestamp=new Date(t[i].Timestamp);for(t.sort(function(n,t){return n.Timestamp<t.Timestamp?1:n.Timestamp>t.Timestamp?-1:0}),r=0;r<t.length;r++)f=t[r],e=u(f),n.collectionHistoryTable.append(e)}function u(n){var t=i.collectionRow.clone().click(function(n){return function(){window.location="/Collection/"+n}}(n.Id));return t.find(".date").text(Format.asDate(n.Timestamp)),t.find(".time").text(Format.asTime(n.Timestamp)),t.find(".site-name").text(n.Machine.Site.Name),t.find(".machine-name").text(n.Machine.Name),t.find(".site-postcode").text(n.Machine.Site.Postcode),n.IsCollection?t.find(".total-collected").find(".collected-value").text(Format.asCurrency(n.TotalValue)).end().find(".currency").text(n.Currency).end():t.find(".total-refilled").find(".refilled-value").text(Format.asCurrency(n.TotalValue)).end().find(".currency").text(n.Currency).end(),t}function f(t){var u;if(t=t||null,n.refillStatusView.toggleClass("hidden",t==null),n.noRefillPlaceholderView.toggleClass("hidden",t!=null),t){for(n.collectionSiteName.text(t.Site.Name),n.collectionSystemName.text(t.Name),t.Denominations.sort(function(n,t){return n.Value-t.Value}),$(".refill-denom").remove(),u=0;u<t.Denominations.length;u++){var r=t.Denominations[u],f=r.IsOver?"overfill":r.IsUnder?"due":"disabled",e=r.IsOver?"+"+r.FloatVarianceLevel:Math.abs(r.FloatVarianceLevel);i.refillDenomination.clone().addClass(f).find(".denom-value").text(Format.asCurrency(r.Value,r.Currency)).end().find(".float-variance").text(e).end().appendTo(r.Type==="Coin"?n.coinsRefillSection:n.billsRefillSection)}n.billsRefillTotal.text(Format.asCurrency(t.BillsRefillDueValue,t.Currency));n.coinsRefillTotal.text(Format.asCurrency(t.CoinsRefillDueValue,t.Currency))}}function o(){var i=$.connection.machineHub;i.client.updateCollection=function(i){var r=new Date(i.Timestamp),f;i.Collector.Id!==t||DatePicker.startDate&&r<DatePicker.startDate||DatePicker.endDate&&r>DatePicker.endDate||(f=u(i),n.collectionHistoryTable.find(".collection-history-clickable-row:first").before(f))};i.client.updateCollector=function(n){f(n.Machine)};$.connection.hub.start().done()}var t=0,n={collectionHistoryTable:$("#collection-history-table tbody"),refillStatusView:$("#collector-refill-system"),noRefillPlaceholderView:$("#collection-status"),coinsRefillSection:$(".currency-column.coins"),billsRefillSection:$(".currency-column.bills"),coinsRefillTotal:$(".currency-column.coins .total"),billsRefillTotal:$(".currency-column.bills .total"),collectionSiteName:$("#collector-refill-machine-site-name"),collectionSystemName:$("#collector-refill-machine-name")},i={collectionRow:Tools.extractTemplate("#template__collection-row"),refillDenomination:Tools.extractTemplate("#template__refill-denom")};this.initialise=function(n){t=n;r();$.get("/Collector/CurrentMachineData",{collectorId:t},function(n){f(n)});DatePicker.setup("#reportrange","#reportrange span",function(n,t){r(n,t)});o()}};