"use strict";var ManagerRefillSystem=new function(){function f(){$.get("/Machine/GetMachine/"+t,function(n){u(n)})}function r(n,i){var r=n?n.toISOString():null,u=i?i.toISOString():null;$.get("/Manager/RefillsData",{machineId:t,from:r,to:u},function(n){e(n)})}function e(t){var u,o,r,f;$(".collection-date-section").remove();for(u in t)if(t.hasOwnProperty(u)){var s=0,h="",e=i.managerRefillDateSection.clone();for(e.find(".day-date").text(Format.asDate(u)),o=0;o<t[u].length;o++)r=t[u][o],s+=r.TotalRefilled,h=r.Currency,f=i.managerRefillRow.clone(),f.find("a").attr("href","/Collection/"+r.Id).text(Format.asTime(r.Timestamp)),f.find(".refill").text(Format.asCurrency(r.TotalRefilled,r.Currency,!0)),f.toggleClass("error",r.IsError),e.append(f);e.find(".full-day-refilled").text(Format.asCurrency(s,h,!0));n.managerRefillsContainer.append(e)}}function u(t){var u;if(t=t||null,n.refillStatusView.toggleClass("hidden",t==null),n.noRefillPlaceholderView.toggleClass("hidden",t!=null),t){for(t.Denominations.sort(function(n,t){return n.Value-t.Value}),$(".refill-denom").remove(),u=0;u<t.Denominations.length;u++){var r=t.Denominations[u],f=r.IsOver?"overfill":r.IsUnder?"due":"disabled",e=r.IsOver?"+"+r.FloatVarianceLevel:Math.abs(r.FloatVarianceLevel);i.refillDenomination.clone().addClass(f).find(".denom-value").text(Format.asCurrency(r.Value,r.Currency)).end().find(".float-variance").text(e).end().appendTo(r.Type==="Coin"?n.coinsRefillSection:n.billsRefillSection)}n.billsRefillTotal.text(Format.asCurrency(t.BillsRefillDueValue,t.Currency));n.coinsRefillTotal.text(Format.asCurrency(t.CoinsRefillDueValue,t.Currency))}}function o(){var n=$.connection.machineHub;n.client.updateMachineStatus=function(n){var i=n.Machine;i.Id===t&&(u(i),r())};$.connection.hub.start().done()}var t=0,n={managerRefillsContainer:$("#collection-times"),refillStatusView:$("#collector-refill-system"),noRefillPlaceholderView:$("#collection-status"),coinsRefillSection:$(".currency-column.coins"),billsRefillSection:$(".currency-column.bills"),coinsRefillTotal:$(".currency-column.coins .total"),billsRefillTotal:$(".currency-column.bills .total")},i={managerRefillRow:Tools.extractTemplate("#template__collection-row"),managerRefillDateSection:Tools.extractTemplate("#template__collection-date-section"),refillDenomination:Tools.extractTemplate("#template__refill-denom")};this.initialise=function(n){t=n;DatePicker.setup("#reportrange","#reportrange span",function(n,t){r(n,t)});r();f();o()}};